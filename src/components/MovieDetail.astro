---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import { getImageUrl, formatRating, getYear, formatRuntime, formatGenres } from '../lib/tmdb.mjs';

interface Props {
  movie: any;
}

const { movie } = Astro.props;

const posterUrl = getImageUrl(movie.poster_path, 'w780');
const backdropUrl = getImageUrl(movie.backdrop_path, 'original');
const rating = formatRating(movie.vote_average);
const year = getYear(movie.release_date);
const runtime = formatRuntime(movie.runtime);
const genres = formatGenres(movie.genres);
const basePath = import.meta.env.BASE_URL || '/';
---

<Layout 
  title={movie.title + ' (' + year + ') - MovieHub'}
  description={movie.overview || 'Watch and discover ' + movie.title}
>
  <Header />
  
  <main>
    <div class="backdrop" style={'background-image: url(' + backdropUrl + ');'}>
      <div class="backdrop-overlay"></div>
    </div>

    <section class="movie-details">
      <div class="container">
        <a href={basePath} class="back-link">Back to Home</a>

        <div class="content">
          <div class="poster-section">
            <img src={posterUrl} alt={movie.title} class="poster" />
          </div>

          <div class="info-section">
            <h1 class="title">{movie.title}</h1>
            {movie.tagline && <p class="tagline">{movie.tagline}</p>}

            <div class="meta">
              <div class="rating-badge">
                <span class="star">‚≠ê</span>
                <span class="rating-value">{rating}</span>
                <span class="rating-max">/10</span>
              </div>
              <span class="meta-item">{year}</span>
              <span class="meta-item">{runtime}</span>
            </div>

            <div class="genres">
              <strong>Genres:</strong> {genres}
            </div>

            <div class="overview-section">
              <h2 class="section-title">Overview</h2>
              <p class="overview">{movie.overview || 'No overview available.'}</p>
            </div>

            <div class="release-info">
              <p><strong>Release Date:</strong> {movie.release_date ? new Date(movie.release_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'N/A'}</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  main {
    position: relative;
    min-height: 100vh;
  }
  .backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 60vh;
    background-size: cover;
    background-position: center;
    z-index: -1;
  }
  .backdrop-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      rgba(10, 14, 23, 0.3) 0%,
      rgba(10, 14, 23, 0.8) 50%,
      #0a0e17 100%
    );
  }
  .movie-details {
    position: relative;
    padding: 3rem 0;
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }
  .back-link {
    display: inline-block;
    margin-bottom: 2rem;
    color: #9ca3af;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s ease;
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    background: #1a2235;
    border: 1px solid #2d3748;
  }
  .back-link:hover {
    color: #3b82f6;
    border-color: #3b82f6;
    transform: translateX(-4px);
  }
  .content {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 3rem;
    margin-top: 15rem;
  }
  .poster-section {
    position: sticky;
    top: 100px;
    height: fit-content;
  }
  .poster {
    width: 100%;
    aspect-ratio: 2/3;
    object-fit: cover;
    border-radius: 0.75rem;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
    border: 1px solid #2d3748;
  }
  .info-section {
    background: #1a2235;
    padding: 3rem;
    border-radius: 0.75rem;
    border: 1px solid #2d3748;
    height: fit-content;
  }
  .title {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    line-height: 1.2;
    color: #e4e7eb;
    margin-top: 0;
  }
  .tagline {
    font-size: 1.125rem;
    color: #9ca3af;
    font-style: italic;
    margin-bottom: 1.5rem;
  }
  .meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #2d3748;
  }
  .rating-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, #3b82f6, #6366f1);
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 700;
    color: white;
  }
  .meta-item {
    color: #9ca3af;
    font-weight: 500;
  }
  .genres {
    margin-bottom: 1.5rem;
    color: #9ca3af;
  }
  .genres strong {
    color: #e4e7eb;
  }
  .overview-section {
    margin-bottom: 1.5rem;
  }
  .section-title {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: #e4e7eb;
    margin-top: 0;
  }
  .overview {
    color: #9ca3af;
    line-height: 1.8;
    font-size: 1.05rem;
  }
  .release-info {
    color: #9ca3af;
    padding-top: 1rem;
    border-top: 1px solid #2d3748;
  }
  .release-info strong {
    color: #e4e7eb;
  }
  @media (max-width: 1024px) {
    .content {
      grid-template-columns: 250px 1fr;
      gap: 2rem;
      margin-top: 10rem;
    }
  }
  @media (max-width: 768px) {
    .content {
      grid-template-columns: 1fr;
      margin-top: 5rem;
    }
    .poster-section {
      position: static;
      max-width: 300px;
      margin: 0 auto;
    }
    .info-section {
      padding: 1.5rem;
    }
  }
</style>
